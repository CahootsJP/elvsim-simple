/**
 * Elevator Simulator - Stylesheet
 * Modern, clean design for real-time visualization
 */

/* Reset and Base Styles */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

/* Light Mode (Default) */
:root {
    --primary-color: #2563eb;
    --secondary-color: #64748b;
    --success-color: #10b981;
    --warning-color: #f59e0b;
    --danger-color: #ef4444;
    --bg-color: #f8fafc;
    --card-bg: #ffffff;
    --text-primary: #1e293b;
    --text-secondary: #64748b;
    --border-color: #e2e8f0;
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    
    /* Additional colors */
    --header-bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --elevator-shaft-bg: repeating-linear-gradient(
        to top,
        #cbd5e1 0%,      /* Darker stripe */
        #cbd5e1 10%,     /* One floor height (10% of total) */
        #e2e8f0 10%,     /* Lighter stripe */
        #e2e8f0 20%      /* One floor height (10% of total) */
    );
    --elevator-car-bg: #e2e8f0;
    --log-bg: #f8fafc;
    --log-border: #e5e7eb;
}

/* Dark Mode */
body.dark-mode {
    --primary-color: #3b82f6;
    --secondary-color: #475569;
    --success-color: #22c55e;
    --warning-color: #fbbf24;
    --danger-color: #f87171;
    --bg-color: #0f172a;
    --card-bg: #1e293b;
    --text-primary: #e2e8f0;
    --text-secondary: #94a3b8;
    --border-color: #334155;
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.4);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
    
    /* Additional dark mode colors */
    --header-bg: linear-gradient(135deg, #4c1d95 0%, #5b21b6 100%);
    --elevator-shaft-bg: repeating-linear-gradient(
        to top,
        #374151 0%,      /* Medium gray (brighter) */
        #374151 10%,
        #4b5563 10%,     /* Lighter gray */
        #4b5563 20%
    );
    --elevator-car-bg: linear-gradient(135deg, #334155, #475569);
    --log-bg: #1e293b;
    --log-border: #334155;
    
    /* Passenger box colors (dark mode) */
    --passenger-box-bg: rgba(45, 55, 72, 0.8);
    --passenger-box-text: #e2e8f0;
    --occupancy-low-bg: rgba(16, 185, 129, 0.15);
    --occupancy-medium-bg: rgba(245, 158, 11, 0.15);
    --occupancy-high-bg: rgba(239, 68, 68, 0.15);
    
    /* Control panel colors (dark mode) */
    --control-panel-bg: rgba(30, 41, 59, 0.95);
    --control-border: rgba(148, 163, 184, 0.2);
    --control-btn-bg: rgba(51, 65, 85, 0.8);
    --control-btn-hover: rgba(75, 85, 99, 0.9);
    --slider-thumb-bg: #e2e8f0;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    background-color: var(--bg-color);
    color: var(--text-primary);
    line-height: 1.6;
}

/* Container */
.container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
}

/* Header */
header {
    background: var(--card-bg);
    padding: 15px 25px;
    border-radius: 10px;
    box-shadow: var(--shadow-md);
    margin-bottom: 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.header-right {
    display: flex;
    align-items: center;
    gap: 15px;
}

/* Dark Mode Toggle Button */
.dark-mode-toggle {
    background: var(--card-bg);
    border: 2px solid var(--border-color);
    border-radius: 8px;
    padding: 8px 12px;
    font-size: 1.2em;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.dark-mode-toggle:hover {
    background: var(--bg-color);
    transform: scale(1.1);
}

.dark-mode-toggle:active {
    transform: scale(0.95);
}

/* Header title with subtitle */
.header-title {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.header-title h1 {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--primary-color);
    margin: 0;
    line-height: 1.2;
}

.header-title .subtitle {
    font-size: 0.75rem;
    font-weight: 400;
    color: var(--text-secondary);
    margin: 0;
    letter-spacing: 0.5px;
    font-style: italic;
}

.connection-status {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.9rem;
    color: var(--text-secondary);
}

.status-indicator {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    display: inline-block;
}

.status-connected {
    background-color: var(--success-color);
    box-shadow: 0 0 8px var(--success-color);
}

.status-paused {
    background-color: var(--warning-color);
    box-shadow: 0 0 8px var(--warning-color);
}

.status-completed {
    background-color: var(--secondary-color);
    box-shadow: 0 0 8px var(--secondary-color);
}

.status-error {
    background-color: var(--danger-color);
    box-shadow: 0 0 8px var(--danger-color);
    animation: pulse-error 2s infinite;
}

.status-disconnected {
    background-color: var(--danger-color);
    box-shadow: 0 0 8px var(--danger-color);
}

@keyframes pulse-error {
    0%, 100% {
        opacity: 1;
    }
    50% {
        opacity: 0.5;
    }
}

/* Main Content */
main {
    /* No grid - tabs handle layout */
}

section {
    background: var(--card-bg);
    padding: 20px;
    border-radius: 12px;
    box-shadow: var(--shadow-md);
}

section h2 {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 12px;
    color: var(--text-primary);
    border-bottom: 2px solid var(--border-color);
    padding-bottom: 6px;
}

/* Control Panel */
.control-panel {
    grid-column: 1;
    grid-row: 1;
}

.controls {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-bottom: 20px;
}

.btn {
    padding: 8px 16px;
    border: none;
    border-radius: 6px;
    font-size: 0.85rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    box-shadow: var(--shadow-sm);
}

.btn:hover:not(:disabled) {
    transform: translateY(-1px);
    box-shadow: var(--shadow-md);
}

.btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.btn-primary {
    background-color: var(--primary-color);
    color: white;
}

.btn-primary:hover:not(:disabled) {
    background-color: #1d4ed8;
}

.btn-secondary {
    background-color: var(--secondary-color);
    color: white;
}

.btn-secondary:hover:not(:disabled) {
    background-color: #475569;
}

.btn-small {
    padding: 6px 12px;
    font-size: 0.85rem;
}

.simulation-time {
    padding: 12px;
    background-color: var(--bg-color);
    border-radius: 8px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.simulation-time label {
    font-weight: 500;
    color: var(--text-secondary);
}

#sim-time {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--primary-color);
    font-family: 'Courier New', monospace;
}

/* Visualization Area */
.visualization {
    /* No grid positioning - inside tab pane */
}

.visualization-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
}

.visualization-header h2 {
    margin: 0;
    font-size: 1.1rem;
}

.visualization-header .simulation-time {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.85rem;
    color: var(--text-secondary);
    background-color: var(--bg-color);
    padding: 6px 12px;
    border-radius: 6px;
    border: 1px solid var(--border-color);
}

.visualization-header .simulation-time label {
    font-weight: 500;
    margin: 0;
}

.visualization-header .simulation-time span {
    font-weight: 600;
    color: var(--primary-color);
    font-family: 'Courier New', monospace;
}

/* ====================================
   NEW GRID LAYOUT: Shared Floor Labels
   ==================================== */

.elevator-grid {
    display: grid;
    grid-template-columns: 50px 1fr; /* [Floor Labels][Elevator Columns] */
    gap: 12px;
    margin-top: 15px;
    overflow-x: auto; /* Allow horizontal scroll for many elevators */
    align-items: start; /* Align items to top */
}

.shared-floor-labels {
    display: flex;
    flex-direction: column;
    left: 0;
    z-index: 10;
    background: linear-gradient(90deg, var(--card-bg) 0%, var(--card-bg) 85%, transparent 100%);
    padding: 0;
    /* Add top margin to align with shaft (after header) */
    margin-top: 73px; /* Height of elevator-column-header (65px) + gap (8px) */
}

.shared-floor-label {
    flex: 1 1 0; /* Equal height for all labels - same as .floor */
    min-height: 25px; /* Match floor height */
    font-size: 11px;
    font-weight: 700;
    color: var(--text-secondary);
    text-align: right;
    padding-right: 8px;
    line-height: 1;
    border-right: 2px solid var(--border-color);
    display: flex;
    align-items: center;
    justify-content: flex-end;
    width: 100%;
    transition: all 0.2s ease;
}

.shared-floor-label:hover {
    color: var(--primary-color);
    font-size: 12px;
    padding-right: 10px;
}

.elevator-columns {
    display: flex;
    gap: 12px;
    align-items: flex-start;
    overflow-x: auto; /* Enable horizontal scroll as fallback */
    scroll-behavior: smooth; /* Smooth scrolling */
    scroll-snap-type: x proximity; /* Snap to columns */
    padding-bottom: 5px; /* Space for scrollbar */
}

/* Scrollbar styling */
.elevator-columns::-webkit-scrollbar {
    height: 8px;
}

.elevator-columns::-webkit-scrollbar-track {
    background: var(--bg-color);
    border-radius: 4px;
}

.elevator-columns::-webkit-scrollbar-thumb {
    background: var(--primary-color);
    border-radius: 4px;
    transition: background 0.3s;
}

.elevator-columns::-webkit-scrollbar-thumb:hover {
    background: #1d4ed8;
}

body.dark-mode .elevator-columns::-webkit-scrollbar-thumb {
    background: var(--primary-color);
}

.elevator-column {
    display: flex;
    flex-direction: column;
    gap: 8px;
    flex-shrink: 0; /* Prevent shrinking */
    scroll-snap-align: start; /* Snap to column start */
    /* Dynamic width based on elevator count: 65px-90px */
    /* Formula: (viewport - margins - gaps) / count */
    width: clamp(65px, calc((100vw - 200px - (var(--elevator-count, 4) - 1) * 12px) / var(--elevator-count, 4)), 90px);
    min-width: 65px;
    max-width: 90px;
}

.elevator-column-header {
    background: linear-gradient(135deg, var(--primary-color), #1d4ed8);
    color: white;
    padding: 8px 10px;
    border-radius: 8px 8px 0 0;
    text-align: center;
    font-size: 0.85rem;
    font-weight: 700;
    letter-spacing: 0.5px;
    box-shadow: var(--shadow-md);
    transition: all 0.3s ease;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    height: 65px; /* 高さを完全に固定して揃える */
    box-sizing: border-box;
}

.elevator-column-header:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
}

.elevator-column-header .elevator-name {
    font-size: clamp(0.8rem, 1.5vw, 0.95rem); /* Scale down with width */
    margin-bottom: 4px;
}

.elevator-column-header .elevator-status {
    font-size: clamp(0.65rem, 1.2vw, 0.75rem); /* Scale down with width */
    background: rgba(255, 255, 255, 0.2);
    padding: 3px 8px;
    border-radius: 10px;
    display: inline-block;
    margin-top: 4px;
    white-space: nowrap;
}

/* Color variants for elevator columns */
.elevator-column[data-elevator="Hall"] .elevator-column-header {
    background: linear-gradient(135deg, #6b7280, #4b5563); /* Gray */
}

.elevator-column[data-elevator*="1"] .elevator-column-header {
    background: linear-gradient(135deg, #3b82f6, #2563eb); /* Blue */
}

.elevator-column[data-elevator*="2"] .elevator-column-header {
    background: linear-gradient(135deg, #f97316, #ea580c); /* Orange */
}

.elevator-column[data-elevator*="3"] .elevator-column-header {
    background: linear-gradient(135deg, #22c55e, #16a34a); /* Green */
}

.elevator-column[data-elevator*="4"] .elevator-column-header {
    background: linear-gradient(135deg, #ef4444, #dc2626); /* Red */
}

/* Old elevator-container (keep for backwards compatibility during transition) */
.elevator-container {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    justify-content: center;
    align-items: flex-start;
}

.elevator-card {
    border: 2px solid var(--border-color);
    border-radius: 8px;
    overflow: hidden;
    transition: all 0.3s;
    flex: 0 1 auto;
    min-width: 120px;   /* 細くする */
    max-width: 140px;   /* 細くする */
    width: 130px;       /* 細くする */
}

.elevator-card:hover {
    box-shadow: var(--shadow-lg);
    transform: translateY(-2px);
}

.elevator-header {
    background: linear-gradient(135deg, var(--primary-color), #1d4ed8);
    color: white;
    padding: 6px 8px;
    display: flex;
    flex-direction: column;  /* 縦並び */
    align-items: center;     /* 中央揃え */
    gap: 4px;                /* エレベーター名と状態の間隔 */
}

/* Elevator-specific header colors */
#elevator-Elevator_1 .elevator-header {
    background: linear-gradient(135deg, #1f77b4, #1565c0); /* Sky blue gradient */
}

#elevator-Elevator_2 .elevator-header {
    background: linear-gradient(135deg, #ff7f0e, #e65100); /* Orange gradient */
}

#elevator-Elevator_3 .elevator-header {
    background: linear-gradient(135deg, #2ca02c, #1b5e20); /* Green gradient */
}

#elevator-Elevator_4 .elevator-header {
    background: linear-gradient(135deg, #d62728, #b71c1c); /* Red gradient */
}

/* Elevator Hall specific styles */
.hall-card .hall-header {
    background: linear-gradient(135deg, #6b7280, #4b5563) !important; /* Gray gradient */
}

.elevator-header h3 {
    font-size: 0.85rem;
    font-weight: 600;
    text-align: center;
    line-height: 1.2;
}

.elevator-state {
    padding: 3px 8px;
    border-radius: 10px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    background-color: rgba(255, 255, 255, 0.2);
    letter-spacing: 0.05em;
    white-space: nowrap;
}

.state-idle {
    background-color: var(--secondary-color) !important;
}

.state-up {
    background-color: var(--success-color) !important;
}

.state-down {
    background-color: var(--warning-color) !important;
}

.elevator-body {
    padding: 8px;
    display: flex;
    justify-content: center;
}

.elevator-visual {
    display: flex;
    flex-direction: column;
    gap: 6px; /* Gap between shaft and passenger box */
    align-items: flex-start;
}

/* Ensure passenger box aligns with shaft */
.elevator-visual .passenger-box {
    margin-left: 30px; /* Offset to align with shaft (24px labels + 6px gap) */
}

.elevator-shaft-container {
    display: flex;
    gap: 6px; /* Gap between labels, shaft, and waiting area */
    align-items: stretch; /* Ensure all children have the same height */
}

.floor-labels {
    position: relative; /* For absolute positioning of labels */
    height: 150px; /* Default height, will be overridden by JavaScript */
    padding: 0; /* No padding to ensure exact alignment */
    flex: 0 0 32px; /* フロアラベル用の幅を広げる (24px → 32px) */
}

.floor-label {
    position: absolute; /* Positioned at floor boundaries */
    left: 0;
    width: 32px; /* 明示的に幅を指定 */
    font-size: 10px;
    color: var(--text-secondary);
    font-weight: 600; /* Slightly bolder for better visibility */
    line-height: 1;
    text-align: center; /* 中央揃えで見やすく */
    padding: 0 2px; /* 左右に余白 */
    box-sizing: border-box; /* padding を含めた幅 */
}

.elevator-shaft {
    width: 100%; /* Fill column width */
    height: 150px; /* Default height, will be overridden by JavaScript */
    /* Zebra stripe background for floor visibility (auto-switches with dark mode) */
    background: var(--elevator-shaft-bg);
    border: 2px solid var(--border-color);
    border-radius: 0 0 8px 8px; /* Rounded bottom corners only */
    position: relative;
    overflow: hidden;
    box-shadow: var(--shadow-sm);
}

/* ====================================
   NEW FLEXBOX SHAFT STRUCTURE
   ==================================== */

.elevator-shaft-wrapper {
    /* Width inherited from .elevator-column */
    width: 100%;
    position: relative;
    border: 2px solid var(--border-color);
    border-radius: 0 0 8px 8px;
    box-shadow: var(--shadow-sm);
    overflow: hidden;
}

.elevator-floors {
    display: flex;
    flex-direction: column;
    width: 100%;
    position: relative;
    z-index: 1;
}

.floor {
    flex: 1 1 0; /* Equal height for all floors */
    min-height: 25px; /* Match car height */
    display: flex;
    align-items: center;
    justify-content: space-between; /* Left, center, and right sides */
    padding: 0 3px; /* Smaller horizontal padding */
    position: relative;
    border-bottom: 1px solid var(--border-color);
}

/* Zebra stripe background for floors */
.floor:nth-child(odd) {
    background-color: #e2e8f0; /* Light mode - lighter stripe */
}

.floor:nth-child(even) {
    background-color: #cbd5e1; /* Light mode - darker stripe */
}

body.dark-mode .floor:nth-child(odd) {
    background-color: #4b5563; /* Dark mode - lighter stripe */
}

body.dark-mode .floor:nth-child(even) {
    background-color: #374151; /* Dark mode - darker stripe */
}

.floor:last-child {
    border-bottom: none;
}

/* Left side: Hall calls (vertical layout ▲ on top, ▼ below) */
.floor-icons-left {
    display: flex;
    flex-direction: column; /* Vertical layout */
    gap: 1px;
    align-items: center;
    justify-content: center;
    z-index: 2;
    min-width: 12px; /* Smaller reserve space */
    flex-shrink: 0;
}

/* Center: Waiting passengers (for Hall only) */
.floor-icons-center {
    display: flex;
    flex-direction: row; /* Horizontal layout - side by side */
    gap: 2px;
    align-items: center;
    justify-content: center;
    z-index: 2;
    flex: 0 1 auto; /* Can shrink if needed */
    min-width: 0; /* Allow shrinking */
    overflow: hidden; /* Hide overflow if too wide */
}

/* Right side: Car calls (vertical layout - preview on top, car call on bottom) */
.floor-icons-right {
    display: flex;
    flex-direction: column; /* Vertical stacking */
    gap: 2px; /* Small gap between indicators */
    align-items: center;
    justify-content: space-around; /* Distribute evenly with space around */
    z-index: 2;
    min-width: 12px; /* Smaller reserve space */
    flex-shrink: 0;
    height: 100%; /* Take full height of floor cell */
    padding: 3px 0; /* Small padding top and bottom */
}

/* Elevator car layer (absolute positioning for animation) */
.elevator-car-layer {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 10;
}

/* Hall shaft specific (no car layer needed) */
.elevator-column[data-elevator="Hall"] .elevator-floors {
    /* Slate-500 blue-gray colors for Hall */
}

.elevator-column[data-elevator="Hall"] .floor:nth-child(odd) {
    background-color: #f3f4f6;
}

.elevator-column[data-elevator="Hall"] .floor:nth-child(even) {
    background-color: #e8eaed;
}

body.dark-mode .elevator-column[data-elevator="Hall"] .floor:nth-child(odd) {
    background-color: #64748b;
}

body.dark-mode .elevator-column[data-elevator="Hall"] .floor:nth-child(even) {
    background-color: #5a6a7e;
}

/* Call Indicators (for new Flexbox structure) */
.call-indicator {
    font-size: 11px;
    pointer-events: auto;
    display: inline-block;
    line-height: 1;
}

.car-call-indicator {
    color: #c084fc; /* Brighter purple */
    text-shadow: 0 0 3px rgba(192, 132, 252, 0.6);
}

/* Car call preview indicator (DCS destination preview) */
.car-call-preview-indicator {
    color: #f59e0b; /* Orange */
    text-shadow: 0 0 3px rgba(245, 158, 11, 0.6);
    opacity: 0.8; /* Slightly transparent to distinguish from actual car calls */
    font-size: 8px; /* Even smaller size */
    display: inline-block;
    line-height: 1;
    margin-bottom: 6px; /* Push away from center, towards top (increased from 4px) */
}

/* Spacer for maintaining position when only one indicator is present */
.call-indicator-spacer {
    font-size: 11px;
    display: inline-block;
    line-height: 1;
    pointer-events: none;
    opacity: 0; /* Invisible but takes up space in flexbox */
}

.hall-call-up-indicator {
    color: #22c55e; /* Green */
    text-shadow: 0 0 3px rgba(34, 197, 94, 0.6);
}

.hall-call-down-indicator {
    color: #ef4444; /* Red */
    text-shadow: 0 0 3px rgba(239, 68, 68, 0.6);
}

/* Forced move command indicator (orange filled diamond) */
.forced-move-command-indicator {
    color: #f59e0b; /* Orange */
    text-shadow: 0 0 3px rgba(245, 158, 11, 0.6);
    font-weight: bold;
}

.forced-move-command-indicator .direction-arrow {
    font-size: 9px;
    margin-left: 1px;
}

/* Move command indicator (green empty square) */
.move-command-indicator {
    color: #10b981; /* Green */
    text-shadow: 0 0 3px rgba(16, 185, 129, 0.6);
}

.waiting-passenger-indicator {
    font-size: 8px;
    pointer-events: auto;
    background: rgba(0, 0, 0, 0.6);
    color: white;
    padding: 1px 3px;
    border-radius: 3px;
    white-space: nowrap;
    display: inline-block;
    line-height: 1.2;
}

.waiting-up {
    color: #a3e635; /* Lime green */
}

.waiting-down {
    color: #fbbf24; /* Amber */
}

/* Capacity Display (for new grid layout) */
.capacity-display {
    background: var(--card-bg);
    border: 2px solid var(--border-color);
    border-radius: 0 0 8px 8px;
    padding: 6px 4px;
    text-align: center;
    margin-top: -2px; /* Merge with shaft border */
    min-width: 0; /* Allow shrinking */
}

.capacity-squares {
    display: flex;
    gap: 2px;
    justify-content: center;
    margin-bottom: 4px;
    flex-wrap: wrap; /* Allow wrapping if needed */
}

.capacity-square {
    width: 6px;
    height: 6px;
    border: 1px solid var(--border-color);
    border-radius: 1px;
    background: var(--card-bg);
    flex-shrink: 0;
}

.capacity-square.filled {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    border-color: #22c55e;
    box-shadow: 0 0 3px rgba(34, 197, 94, 0.4);
}

.capacity-text {
    font-size: clamp(0.55rem, 1vw, 0.65rem); /* Scale with width */
    color: var(--text-secondary);
    font-weight: 600;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.capacity-text span {
    display: block;
    line-height: 1.2;
}

.elevator-car {
    width: 60%; /* 60% of shaft width to avoid overlapping with call indicators */
    height: 25px;
    background: linear-gradient(135deg, #3b82f6, #2563eb);
    border: 2px solid #1d4ed8;
    border-radius: 4px;
    position: absolute;
    left: 50%; /* Center horizontally */
    transform: translateX(-50%); /* Center using transform instead of margin */
    bottom: 0%;
    transition: bottom 0.5s ease-in-out; /* Smooth movement animation */
    box-shadow: 0 2px 8px rgba(59, 130, 246, 0.4); /* Subtle glow */
    transition: bottom 0.5s ease-in-out;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    overflow: visible; /* Allow doors to be visible */
}

/* Elevator-specific car colors */
#elevator-Elevator_1 .elevator-car {
    background: linear-gradient(135deg, #1f77b4, #1565c0);
    border-color: #0d47a1;
}

#elevator-Elevator_2 .elevator-car {
    background: linear-gradient(135deg, #ff7f0e, #e65100);
    border-color: #bf360c;
}

#elevator-Elevator_3 .elevator-car {
    background: linear-gradient(135deg, #2ca02c, #1b5e20);
    border-color: #0d5e0d;
}

#elevator-Elevator_4 .elevator-car {
    background: linear-gradient(135deg, #d62728, #b71c1c);
    border-color: #8b0000;
}

.elevator-car::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 50%; /* Proportional to car width */
    height: 20px;
    background: rgba(255, 255, 255, 0.3);
    border-radius: 3px;
}

/* Door elements - Single line that splits into two */
.door {
    position: absolute;
    top: 10%;
    width: 2px;
    height: 80%;
    background: #1e3a8a; /* Dark blue for door */
    box-shadow: 0 0 2px rgba(0, 0, 0, 0.5);
    z-index: 10; /* Above the car background */
    transition: all 0.8s ease-in-out; /* Smooth transition for all properties */
}

/* Door closed state - both lines at center (looks like one line) */
.door-left {
    left: 50%;
    transform: translateX(-1px); /* Slightly left of center */
}

.door-right {
    left: 50%;
    transform: translateX(0px); /* Slightly right of center, overlapping */
}

/* Door opening state - lines start moving to sides */
.elevator-car.door-opening .door-left {
    left: 10%; /* Moving to left edge */
    transform: translateX(0);
}

.elevator-car.door-opening .door-right {
    left: 90%; /* Moving to right edge */
    transform: translateX(-2px);
}

/* Door open state - lines stay at sides */
.elevator-car.door-open .door-left {
    left: 10%; /* At left edge */
    transform: translateX(0);
}

.elevator-car.door-open .door-right {
    left: 90%; /* At right edge */
    transform: translateX(-2px);
}

/* Door closing state - lines moving back to center */
.elevator-car.door-closing .door-left {
    left: 50%; /* Moving back to center */
    transform: translateX(-1px);
}

.elevator-car.door-closing .door-right {
    left: 50%; /* Moving back to center */
    transform: translateX(0px);
}

/* Door closed state (explicit for clarity) */
.elevator-car.door-closed .door-left {
    left: 50%;
    transform: translateX(-1px);
}

.elevator-car.door-closed .door-right {
    left: 50%;
    transform: translateX(0px);
}

/* Car call indicators (● purple filled circle, small) */
.car-call-indicator {
    position: absolute;
    right: 10%; /* Position on the right side of the shaft (moved further right) */
    width: 16px;
    height: 16px;
    font-size: 12px; /* Small size */
    color: #c084fc; /* Brighter purple (Purple-400) */
    display: flex;
    align-items: center;
    justify-content: center;
    line-height: 1;
    pointer-events: auto; /* Allow hover */
    z-index: 5; /* Below elevator car (z-index: 10) but above background */
    margin-bottom: -8px; /* Offset half the height to center vertically */
    margin-right: -8px; /* Offset half the width to center horizontally */
    opacity: 0.9;
    text-shadow: 0 0 3px rgba(192, 132, 252, 0.6); /* Brighter glow */
    transition: all 0.2s ease; /* Smooth transition for hover */
}

.car-call-indicator:hover {
    opacity: 1;
    transform: scale(1.2); /* Slightly enlarge on hover */
}

/* Hall call indicators (▲ UP green, ▼ DOWN orange) */
.hall-call-indicator {
    position: absolute;
    left: 10%; /* Position on the left side of the shaft (moved further left) */
    width: 16px;
    height: 16px;
    font-size: 12px; /* Small size */
    display: flex;
    align-items: center;
    justify-content: center;
    line-height: 1;
    pointer-events: auto; /* Allow hover */
    z-index: 5; /* Below elevator car (z-index: 10) but above background */
    margin-bottom: -8px; /* Offset half the height to center vertically */
    margin-left: -8px; /* Offset half the width to center horizontally */
    opacity: 0.9;
    transition: all 0.2s ease; /* Smooth transition for hover */
}

/* UP hall call - Green */
.hall-call-up {
    color: #48bb78; /* Green color */
    text-shadow: 0 0 2px rgba(72, 187, 120, 0.5); /* Subtle glow */
}

/* DOWN hall call - Orange */
.hall-call-down {
    color: #ed8936; /* Orange color */
    text-shadow: 0 0 2px rgba(237, 137, 54, 0.5); /* Subtle glow */
}

.hall-call-indicator:hover {
    opacity: 1;
    transform: scale(1.2); /* Slightly enlarge on hover */
}

/* Passenger Box Styles */
.passenger-box {
    width: 60px; /* Same width as elevator shaft */
    height: 50px;
    border: 2px solid var(--border-color);
    border-radius: 8px;
    padding: 6px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    background-color: var(--card-bg);
    transition: all 0.3s ease;
    /* No margin - will align with shaft using parent positioning */
}

/* Occupancy-based colors */
.passenger-box.occupancy-low {
    background-color: #f0fdf4; /* Light green */
    border-color: var(--border-color); /* Keep gray border */
}

body.dark-mode .passenger-box.occupancy-low {
    background-color: var(--occupancy-low-bg);
}

.passenger-box.occupancy-medium {
    background-color: #fffbeb; /* Light yellow */
    border-color: var(--border-color); /* Keep gray border */
}

body.dark-mode .passenger-box.occupancy-medium {
    background-color: var(--occupancy-medium-bg);
}

.passenger-box.occupancy-high {
    background-color: #fef2f2; /* Light red */
    border-color: var(--border-color); /* Keep gray border */
}

body.dark-mode .passenger-box.occupancy-high {
    background-color: var(--occupancy-high-bg);
}

.passenger-squares {
    display: flex;
    gap: 1px; /* Very narrow spacing between squares */
    align-items: center;
    justify-content: flex-start;
    flex-wrap: wrap;
    min-height: 12px;
}

.passenger-square {
    font-size: 7px; /* Much smaller size */
    line-height: 1;
    transition: all 0.2s ease;
    color: #9ca3af; /* Gray color for all squares */
}

/* Color squares based on occupancy - override to gray */
.occupancy-low .passenger-square {
    color: #9ca3af; /* Gray */
}

.occupancy-medium .passenger-square {
    color: #9ca3af; /* Gray */
}

.occupancy-high .passenger-square {
    color: #9ca3af; /* Gray */
}

.passenger-extra {
    font-size: 10px;
    font-weight: bold;
    margin-left: 2px;
}

/* Color extra text based on occupancy */
.occupancy-low .passenger-extra {
    color: #22c55e;
}

.occupancy-medium .passenger-extra {
    color: #f59e0b;
}

.occupancy-high .passenger-extra {
    color: #ef4444;
}

.passenger-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.passenger-count {
    font-size: 11px;
    font-weight: 600;
    color: var(--text-primary);
}

.passenger-percent {
    font-size: 10px;
    font-weight: 500;
    color: var(--text-secondary);
}

/* Waiting Passengers Styles */
.waiting-passengers {
    width: 50px; /* Compact space for waiting passengers display */
    height: 150px; /* Default height, will be overridden by JavaScript */
    position: relative;
    flex: 0 0 50px; /* Fixed width */
}

/* Hall Shaft Styles (for Elevator Hall panel - same as elevator shaft) */
.hall-shaft {
    width: 70px; /* エレベーターシャフトと同じ幅に統一 */
    height: 150px; /* Default height, will be overridden by JavaScript */
    /* Zebra stripe background for floor visibility (light mode) */
    background: repeating-linear-gradient(
        to top,
        #e8eaed 0%,      /* Lighter darker stripe for hall */
        #e8eaed 10%,     /* One floor height (10% of total) */
        #f3f4f6 10%,     /* Lighter stripe */
        #f3f4f6 20%      /* One floor height (10% of total) */
    );
    border: 2px solid var(--border-color);
    border-radius: 8px;
    position: relative;
    overflow: visible; /* Allow waiting passengers to be visible */
}

/* Dark mode: Slate-500 blue-gray for elevator hall */
body.dark-mode .hall-shaft {
    background: repeating-linear-gradient(
        to top,
        #5a6a7e 0%,      /* Darker blue-gray stripe */
        #5a6a7e 10%,
        #64748b 10%,     /* Lighter blue-gray stripe (Slate-500) */
        #64748b 20%
    );
}

.waiting-floor {
    position: absolute;
    left: 0;
    width: 100%;
    display: flex;
    gap: 8px; /* Gap between UP and DOWN displays */
    align-items: center;
    justify-content: flex-start;
    font-size: 11px;
    line-height: 1;
    margin-bottom: -6px; /* Center vertically on floor line */
}

/* Waiting floor in hall shaft - centered layout */
.hall-shaft .waiting-floor {
    justify-content: center; /* Center in the wider hall shaft */
    padding: 0 8px;
}

.waiting-up {
    color: #22c55e; /* Green for UP */
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 2px;
}

.waiting-down {
    color: #f59e0b; /* Orange for DOWN */
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 2px;
}

.waiting-passenger-icon {
    font-size: 12px;
}

.waiting-count {
    font-size: 11px;
    font-weight: 600;
    margin: 0 2px;
}

.waiting-direction-icon {
    font-size: 13px;
    font-weight: bold;
    margin-left: 2px;
}

.waiting-extra {
    font-size: 9px;
    font-weight: bold;
    margin-left: 1px;
}


/* Event Log */
.log-section {
    padding: 20px;
}

.log-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.log-controls label {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 0.85rem;
    color: var(--text-secondary);
}

.log-container {
    flex: 1;
    max-height: 500px;
    overflow-y: auto;
    background-color: var(--bg-color);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 10px;
    font-family: 'Courier New', monospace;
    font-size: 0.85rem;
}

.log-entry {
    padding: 6px 10px;
    margin-bottom: 4px;
    border-radius: 4px;
    border-left: 3px solid transparent;
}

.log-system {
    background-color: rgba(37, 99, 235, 0.1);
    border-left-color: var(--primary-color);
}

.log-event {
    background-color: rgba(16, 185, 129, 0.1);
    border-left-color: var(--success-color);
}

.log-warning {
    background-color: rgba(245, 158, 11, 0.1);
    border-left-color: var(--warning-color);
}

.log-error {
    background-color: rgba(239, 68, 68, 0.1);
    border-left-color: var(--danger-color);
}

.log-time {
    color: var(--text-secondary);
    font-weight: 600;
    margin-right: 8px;
}

.log-message {
    color: var(--text-primary);
}

/* Footer */
footer {
    margin-top: 20px;
    text-align: center;
    padding: 15px;
    color: var(--text-secondary);
    font-size: 0.9rem;
}

/* Scrollbar Styling */
.log-container::-webkit-scrollbar {
    width: 8px;
}

.log-container::-webkit-scrollbar-track {
    background: var(--bg-color);
    border-radius: 4px;
}

.log-container::-webkit-scrollbar-thumb {
    background: var(--secondary-color);
    border-radius: 4px;
}

.log-container::-webkit-scrollbar-thumb:hover {
    background: #475569;
}

/* Responsive Design */
@media (max-width: 1024px) {
    .tab-navigation {
        overflow-x: auto;
    }
    
    .tab-nav-btn {
        flex-shrink: 0;
        padding: 12px 20px;
        font-size: 0.9rem;
    }
    
    /* Operation layout: stack vertically on smaller screens */
    .operation-layout {
        grid-template-columns: 1fr;
        gap: 15px;
        padding: 15px;
    }
}

@media (max-width: 768px) {
    .elevator-container {
        flex-direction: column;
        align-items: stretch;
    }
    
    .elevator-card {
        min-width: 100%;
        max-width: 100%;
    }
    
    header {
        flex-direction: column;
        gap: 15px;
        text-align: center;
    }
    
    /* Adjust waiting passengers area for small screens */
    .waiting-passengers {
        width: 100px;
        flex: 0 0 100px;
    }
    
    .waiting-floor {
        font-size: 10px;
        gap: 6px;
    }
    
    .waiting-passenger-icon {
        font-size: 9px;
    }
    
    .waiting-direction-icon {
        font-size: 11px;
    }
}

/* ==========================================
   Mode Selector & Playback Controls
   ========================================== */

.mode-selector-panel {
    background: var(--card-bg);
    padding: 15px;
    border-radius: 8px;
    box-shadow: var(--shadow-md);
    margin-bottom: 0;
    border: 1px solid var(--border-color);
}

body.dark-mode .mode-selector-panel {
    background: var(--control-panel-bg);
    border-color: var(--control-border);
    backdrop-filter: blur(10px);
}

.mode-selector-panel h2 {
    margin-top: 0;
    margin-bottom: 12px;
    font-size: 1rem;
}

.mode-buttons {
    display: flex;
    gap: 8px;
    margin-bottom: 12px;
}

.mode-btn {
    flex: 1;
    padding: 10px 16px;
    font-size: 0.95em;
    border: 2px solid var(--border-color);
    background: var(--card-bg);
    color: var(--text-primary);
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s ease;
}

body.dark-mode .mode-btn {
    background: var(--control-btn-bg);
    border-color: var(--control-border);
}

body.dark-mode .mode-btn:hover {
    background: var(--control-btn-hover);
}

.mode-btn:hover {
    background: #f5f5f5;
    border-color: #4a90e2;
}

.mode-btn.active {
    background: var(--header-bg);
    color: white;
    border-color: var(--primary-color);
}

.file-selector {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.log-file-select {
    width: 100%;
    padding: 8px;
    font-size: 0.9em;
    border: 2px solid #ddd;
    border-radius: 6px;
    background: var(--card-bg);
    color: var(--text-primary);
}

body.dark-mode .log-file-select {
    background: var(--control-btn-bg);
    border-color: var(--control-border);
    color: var(--text-primary);
}

.file-selector .btn {
    width: 100%;
}

/* Playback Controls */
.playback-controls-panel {
    background: var(--card-bg);
    padding: 15px;
    border-radius: 8px;
    box-shadow: var(--shadow-md);
    border: 1px solid var(--border-color);
    margin-bottom: 0;
}

body.dark-mode .playback-controls-panel {
    background: var(--control-panel-bg);
    border-color: var(--control-border);
    backdrop-filter: blur(10px);
}

.playback-controls-panel h2 {
    margin-top: 0;
    margin-bottom: 12px;
    font-size: 1rem;
}

.controls-row {
    display: flex;
    align-items: center;
    gap: 6px;
    margin-bottom: 12px;
    flex-wrap: wrap;
}

.time-display {
    display: flex;
    align-items: center;
    gap: 4px;
    padding: 0 10px;
    font-family: 'Courier New', monospace;
    font-size: 0.95em;
    font-weight: bold;
}

.time-separator {
    color: #999;
}

.speed-select {
    padding: 8px 12px;
    font-size: 0.9em;
    border: 2px solid #ddd;
    border-radius: 6px;
    cursor: pointer;
    background: var(--card-bg);
    color: var(--text-primary);
}

body.dark-mode .speed-select {
    background: var(--control-btn-bg);
    border-color: var(--control-border);
    color: var(--text-primary);
}

.timeline-row {
    width: 100%;
}

.timeline-slider {
    width: 100%;
    height: 8px;
    border-radius: 4px;
    background: var(--header-bg);
    outline: none;
    opacity: 0.7;
    transition: opacity 0.2s;
    cursor: pointer;
}

.timeline-slider:hover {
    opacity: 1;
}

.timeline-slider::-webkit-slider-thumb {
    appearance: none;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: var(--card-bg);
    border: 3px solid var(--primary-color);
    cursor: pointer;
}

body.dark-mode .timeline-slider::-webkit-slider-thumb {
    background: var(--slider-thumb-bg);
}

.timeline-slider::-moz-range-thumb {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: var(--card-bg);
    border: 3px solid var(--primary-color);
    cursor: pointer;
}

body.dark-mode .timeline-slider::-moz-range-thumb {
    background: var(--slider-thumb-bg);
}

/* ==========================================
   Tab Navigation (Horizontal)
   ========================================== */

.tab-navigation {
    display: flex;
    background: var(--card-bg);
    border-bottom: 2px solid var(--border-color);
    margin-bottom: 0;
    box-shadow: var(--shadow-sm);
}

.tab-nav-btn {
    flex: 0 0 auto;
    padding: 12px 24px;
    border: none;
    background: transparent;
    color: var(--text-secondary);
    font-size: 0.95rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    border-bottom: 3px solid transparent;
    position: relative;
}

.tab-nav-btn:hover {
    background: var(--bg-color);
    color: var(--text-primary);
}

.tab-nav-btn.active {
    color: var(--primary-color);
    border-bottom-color: var(--primary-color);
    background: var(--bg-color);
    font-weight: 600;
}

/* Tab Container */
.tab-container {
    background: var(--bg-color);
    min-height: calc(100vh - 250px);
}

.tab-pane {
    display: none;
    animation: fadeIn 0.3s ease;
}

.tab-pane.active {
    display: block;
}

/* Operation Tab Layout (2-column) */
.operation-layout {
    display: grid;
    grid-template-columns: 350px 1fr;
    gap: 15px;
    padding: 15px;
}

.operation-left {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.operation-right {
    /* Full width for elevator visualization */
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Metrics Section */
.metrics-section {
    padding: 20px;
}

.metrics-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-top: 15px;
}

.metric-card {
    background: var(--bg-color);
    border: 2px solid var(--border-color);
    border-radius: 8px;
    padding: 15px;
}

.metric-card h3 {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 12px;
    border-bottom: 2px solid var(--border-color);
    padding-bottom: 8px;
}

.metric-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
    border-bottom: 1px solid var(--border-color);
}

.metric-item:last-child {
    border-bottom: none;
}

.metric-label {
    font-size: 0.9rem;
    color: var(--text-secondary);
    font-weight: 500;
}

.metric-value {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--primary-color);
    font-family: 'Courier New', monospace;
}

/* Chart Container */
.chart-container {
    margin-top: 20px;
}

.chart-card {
    grid-column: 1 / -1; /* Span full width */
}

.chart-wrapper {
    height: 300px;
    position: relative;
}

/* Per-Elevator Stats */
.per-elevator-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 10px;
}

.elevator-stat-item {
    display: flex;
    justify-content: space-between;
    padding: 8px 12px;
    background: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 4px;
}

.elevator-stat-name {
    font-weight: 600;
    color: var(--text-primary);
}

.elevator-stat-value {
    font-family: 'Courier New', monospace;
    color: var(--text-secondary);
}

/* Event Filter Section */
.event-filter-section {
    background: var(--card-bg);
    border: 2px solid var(--border-color);
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 15px;
}

.event-filter-section h3 {
    font-size: 0.95rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 10px;
}

.event-filter-controls {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 10px;
    margin-bottom: 10px;
}

.filter-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.filter-checkbox {
    display: flex;
    align-items: center;
    cursor: pointer;
    padding: 6px 10px;
    border-radius: 4px;
    transition: background-color 0.2s ease;
}

.filter-checkbox:hover {
    background: var(--bg-color);
}

.filter-checkbox input[type="checkbox"] {
    margin-right: 8px;
    cursor: pointer;
    width: 16px;
    height: 16px;
}

.filter-checkbox span {
    font-size: 0.9rem;
    color: var(--text-primary);
    user-select: none;
}

.filter-actions {
    display: flex;
    gap: 8px;
    margin-top: 10px;
    padding-top: 10px;
    border-top: 1px solid var(--border-color);
}

.filter-actions button {
    font-size: 0.85rem;
    padding: 4px 10px;
}


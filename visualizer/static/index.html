<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VTS Control Suite - Real-time Visualization</title>
    <link rel="stylesheet" href="style.css?v=39">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-title">
                <h1><img src="VTS.png" alt="VTS" style="height: 1.5em; vertical-align: middle; margin-right: 0.3em;"> VTS Control Suite</h1>
                <p class="subtitle">Vertical Transport System Control Suite</p>
            </div>
            <div class="header-right">
                <button id="dark-mode-toggle" class="dark-mode-toggle" title="Toggle Dark Mode">
                    <span class="icon-light">‚òÄÔ∏è</span>
                    <span class="icon-dark" style="display: none;">üåô</span>
                </button>
                <div class="connection-status">
                    <span id="status-indicator" class="status-disconnected"></span>
                    <span id="status-text">Disconnected</span>
                </div>
            </div>
        </header>

        <!-- Horizontal Tab Navigation -->
        <nav class="tab-navigation">
            <button class="tab-nav-btn active" data-tab="operation">Operation</button>
            <button class="tab-nav-btn" data-tab="metrics">Simulation Metrics</button>
            <button class="tab-nav-btn" data-tab="performance">Performance Monitor</button>
            <button class="tab-nav-btn" data-tab="log">Event Log</button>
        </nav>

        <!-- Tab Contents -->
        <main class="tab-container">
            <!-- Tab 1: Operation -->
            <div id="tab-operation" class="tab-pane active">
                <div class="operation-layout">
                    <!-- Left Column: Controls -->
                    <div class="operation-left">
                        <!-- Mode Selector -->
                        <section class="mode-selector-panel">
                            <h2>Mode</h2>
                            <div class="mode-buttons">
                                <button id="mode-live" class="mode-btn active" data-mode="live">
                                    üî¥ Live
                                </button>
                                <button id="mode-replay" class="mode-btn" data-mode="replay">
                                    üìÅ Replay
                                </button>
                            </div>
                            <div id="file-selector" class="file-selector" style="display: none;">
                                <select id="log-file-select" class="log-file-select">
                                    <option value="">-- Select Log File --</option>
                                </select>
                                <button id="btn-load-file" class="btn btn-primary">Load</button>
                            </div>
                        </section>

                        <!-- Playback Controls (Replay mode only) -->
                        <section id="playback-controls" class="playback-controls-panel" style="display: none;">
                            <h2>Playback Controls</h2>
                            <div class="controls-row">
                                <button id="btn-play-pause" class="btn btn-primary">‚ñ∂ Play</button>
                                <button id="btn-restart" class="btn btn-secondary">‚Üª Restart</button>
                                <div class="time-display">
                                    <span id="current-time">0:00</span>
                                    <span class="time-separator">/</span>
                                    <span id="total-time">0:00</span>
                                </div>
                                <select id="speed-select" class="speed-select">
                                    <option value="0.25">0.25x</option>
                                    <option value="0.5">0.5x</option>
                                    <option value="1" selected>1x</option>
                                    <option value="2">2x</option>
                                    <option value="5">5x</option>
                                    <option value="10">10x</option>
                                </select>
                            </div>
                            <div class="timeline-row">
                                <input type="range" id="timeline-slider" class="timeline-slider" 
                                       min="0" max="100" value="0" step="0.1">
                            </div>
                        </section>
                    </div>

                    <!-- Right Column: Elevator Visualization -->
                    <div class="operation-right">
                        <section class="visualization">
                            <div class="visualization-header">
                                <h2>üè¢ Elevator Status Monitor</h2>
                                <div class="simulation-time">
                                    <label>Simulation Time:</label>
                                    <span id="sim-time">0.00s</span>
                                </div>
                            </div>
                            <!-- New Grid Layout with Shared Floor Labels -->
                            <div id="elevator-grid" class="elevator-grid">
                                <!-- Floor labels column (shared) -->
                                <div class="shared-floor-labels" id="shared-floor-labels">
                                    <!-- Floor labels will be dynamically created here -->
                                </div>
                                <!-- Elevator columns container -->
                                <div class="elevator-columns" id="elevator-columns">
                                    <!-- Elevator Hall and individual elevators will be dynamically created here -->
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
            </div>

            <!-- Tab 2: Simulation Metrics -->
            <div id="tab-metrics" class="tab-pane">
                <section class="metrics-section">
                    <h2>Simulation Metrics</h2>
                    <div class="metrics-container">
                        <div class="metric-card">
                            <h3>Passenger Statistics</h3>
                            <div class="metric-item">
                                <span class="metric-label">Total Passengers:</span>
                                <span id="metric-total-passengers" class="metric-value">0</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">Avg Wait Time:</span>
                                <span id="metric-avg-wait-time" class="metric-value">0.0s</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">Max Wait Time:</span>
                                <span id="metric-max-wait-time" class="metric-value">0.0s</span>
                            </div>
                        </div>
                        <div class="metric-card">
                            <h3>Elevator Operations</h3>
                            <div class="metric-item">
                                <span class="metric-label">Passengers Transported:</span>
                                <span id="metric-total-trips" class="metric-value">0</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">Avg Occupancy:</span>
                                <span id="metric-avg-occupancy" class="metric-value">0%</span>
                            </div>
                        </div>
                    </div>
                    <!-- Wait Time Chart -->
                    <div class="chart-container">
                        <div class="metric-card chart-card">
                            <h3>Average Wait Time Over Time</h3>
                            <div class="chart-wrapper">
                                <canvas id="waitTimeChart"></canvas>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Tab 3: Performance Monitor -->
            <div id="tab-performance" class="tab-pane">
                <section class="performance-section">
                    <h2>Performance Monitor</h2>
                    <p style="color: var(--text-secondary); font-size: 0.9em; margin-bottom: 20px;">Real-world compatible metrics (available for both simulation and actual elevators)</p>
                    
                    <div class="metrics-container">
                        <!-- Service Quality -->
                        <div class="metric-card">
                            <h3>üìä Service Quality</h3>
                            <div class="metric-item">
                                <span class="metric-label">Hall Call Response Time (avg):</span>
                                <span id="perf-avg-response-time" class="metric-value">-</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">Max Response Time:</span>
                                <span id="perf-max-response-time" class="metric-value">-</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">Long Response (&gt;60s):</span>
                                <span id="perf-long-response-count" class="metric-value">0 calls</span>
                            </div>
                        </div>
                        
                        <!-- Elevator Operations -->
                        <div class="metric-card">
                            <h3>üöÄ Elevator Operations</h3>
                            <div class="metric-item">
                                <span class="metric-label">Total Trips:</span>
                                <span id="perf-total-trips" class="metric-value">0</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">Door Operations:</span>
                                <span id="perf-door-operations" class="metric-value">0</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">Total Distance:</span>
                                <span id="perf-total-distance" class="metric-value">0 m</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Per-Elevator Stats -->
                    <div class="metric-card" style="margin-top: 20px;">
                        <h3>üìà Per-Elevator Stats</h3>
                        <div id="per-elevator-stats" class="per-elevator-stats">
                            <!-- Dynamically populated -->
                            <p style="color: var(--text-secondary); font-style: italic;">No data available yet...</p>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Tab 4: Event Log -->
            <div id="tab-log" class="tab-pane">
                <section class="log-section">
                    <h2>Event Log</h2>
                    <div class="log-controls">
                        <button id="btn-clear-log" class="btn btn-secondary btn-small">Clear Log</button>
                        <label>
                            <input type="checkbox" id="chk-auto-scroll" checked>
                            Auto-scroll
                        </label>
                    </div>
                    
                    <!-- Event Filter Section -->
                    <div class="event-filter-section">
                        <h3>Filter by Category:</h3>
                        <div class="event-filter-controls">
                            <div class="filter-group">
                                <label class="filter-checkbox">
                                    <input type="checkbox" id="filter-door" class="event-filter" data-category="door" checked>
                                    <span>üö™ Door Events</span>
                                </label>
                                <label class="filter-checkbox">
                                    <input type="checkbox" id="filter-hall" class="event-filter" data-category="hall">
                                    <span>üîº Hall Calls</span>
                                </label>
                                <label class="filter-checkbox">
                                    <input type="checkbox" id="filter-car" class="event-filter" data-category="car">
                                    <span>üéØ Car Calls</span>
                                </label>
                            </div>
                            <div class="filter-group">
                                <label class="filter-checkbox">
                                    <input type="checkbox" id="filter-passenger" class="event-filter" data-category="passenger">
                                    <span>üë§ Passengers</span>
                                </label>
                                <label class="filter-checkbox">
                                    <input type="checkbox" id="filter-elevator" class="event-filter" data-category="elevator" checked>
                                    <span>üìä Elevator Status</span>
                                </label>
                                <label class="filter-checkbox">
                                    <input type="checkbox" id="filter-command" class="event-filter" data-category="command">
                                    <span>‚ö° Commands</span>
                                </label>
                            </div>
                        </div>
                        <div class="filter-actions">
                            <button id="btn-select-all-filters" class="btn btn-secondary btn-small">Select All</button>
                            <button id="btn-deselect-all-filters" class="btn btn-secondary btn-small">Deselect All</button>
                        </div>
                    </div>
                    
                    <div id="log-container" class="log-container">
                        <!-- Event logs will appear here -->
                    </div>
                </section>
            </div>
        </main>

        <footer>
            <p>VTS Control Suite - Vertical Transport System Simulator</p>
        </footer>
    </div>

    <script src="eventSource.js?v=2"></script>
    <script src="app.js?v=46"></script>
</body>
</html>
